<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon Escape Duo</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #2c3e50;
            font-family: Arial, sans-serif;
        }
        #game-container {
            text-align: center;
        }
        h1 {
            color: #ecf0f1;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Dungeon Escape Duo</h1>
        <div id="game"></div>
    </div>

    <!-- Phaser 3 Library via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    
    <!-- Socket.io Client Library -->
    <script src="/socket.io/socket.io.js"></script>
    
    <script>
        // Socket.io connection
        const socket = io();
        
        socket.on('connect', () => {
            console.log('Connected to server');
        });
        
        socket.on('disconnect', () => {
            console.log('Disconnected from server');
        });

        // Dungeon Level Layout
        // 0 = floor tile (walkable)
        // 1 = wall tile (not walkable)
        const dungeonLayout = [
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 1],
            [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
        ];

        // Grid configuration
        const GRID_WIDTH = 12;
        const GRID_HEIGHT = 8;
        const TILE_SIZE = 50;

        // Player configuration
        let player1 = {
            x: 1,  // Grid position (column)
            y: 1,  // Grid position (row)
            sprite: null  // Will hold the Phaser sprite
        };

        // Phaser 3 Game Configuration
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game',
            backgroundColor: '#34495e',
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        // Phaser 3 Scene Functions
        function preload() {
            // Preload assets (none for now)
        }

        function create() {
            // Store reference to this scene for later use
            window.gameScene = this;
            
            // Render the dungeon grid
            renderDungeonGrid(this);
            
            // Create player sprite
            createPlayerSprite(this);
            
            // Set up keyboard input
            setupKeyboardInput(this);
            
            // Add game title above the grid
            this.add.text(400, 50, 'Dungeon Escape Duo', {
                fontSize: '24px',
                fill: '#ecf0f1'
            }).setOrigin(0.5);
            
            // Add status text below the grid
            this.add.text(400, 550, 'Use arrow keys to move', {
                fontSize: '16px',
                fill: '#bdc3c7'
            }).setOrigin(0.5);
        }

        // Function to render the dungeon grid
        function renderDungeonGrid(scene) {
            // Calculate starting position to center the grid
            const startX = (800 - (GRID_WIDTH * TILE_SIZE)) / 2;
            const startY = (600 - (GRID_HEIGHT * TILE_SIZE)) / 2;
            
            // Loop through each row
            for (let row = 0; row < GRID_HEIGHT; row++) {
                // Loop through each column
                for (let col = 0; col < GRID_WIDTH; col++) {
                    // Get the tile type from the dungeon layout
                    const tileType = dungeonLayout[row][col];
                    
                    // Calculate pixel position
                    const x = startX + (col * TILE_SIZE);
                    const y = startY + (row * TILE_SIZE);
                    
                    // Choose color based on tile type
                    let color;
                    if (tileType === 0) {
                        color = 0x95a5a6; // Light grey for floor tiles
                    } else if (tileType === 1) {
                        color = 0x2c3e50; // Dark grey for wall tiles
                    }
                    
                    // Create a rectangle for this tile
                    const tile = scene.add.rectangle(x, y, TILE_SIZE - 2, TILE_SIZE - 2, color);
                    tile.setOrigin(0, 0);
                    
                    // Add a subtle border effect
                    const border = scene.add.rectangle(x, y, TILE_SIZE, TILE_SIZE);
                    border.setStrokeStyle(1, 0x34495e);
                    border.setOrigin(0, 0);
                    border.setFillStyle();
                }
            }
        }

        // Function to create player sprite
        function createPlayerSprite(scene) {
            // Calculate starting position to center the grid (same as renderDungeonGrid)
            const startX = (800 - (GRID_WIDTH * TILE_SIZE)) / 2;
            const startY = (600 - (GRID_HEIGHT * TILE_SIZE)) / 2;
            
            // Calculate pixel position for player based on grid position
            const pixelX = startX + (player1.x * TILE_SIZE) + (TILE_SIZE / 2);
            const pixelY = startY + (player1.y * TILE_SIZE) + (TILE_SIZE / 2);
            
            // Create blue square sprite for player
            player1.sprite = scene.add.rectangle(pixelX, pixelY, TILE_SIZE - 10, TILE_SIZE - 10, 0x3498db);
            
            // Add a white border to make it stand out
            player1.sprite.setStrokeStyle(2, 0xffffff);
            
            // Make sure player is rendered on top of the grid
            player1.sprite.setDepth(100);
        }

        // Function to set up keyboard input
        function setupKeyboardInput(scene) {
            // Create cursor keys for arrow key input
            window.cursors = scene.input.keyboard.createCursorKeys();
            
            // Set up individual key listeners for immediate response
            scene.input.keyboard.on('keydown-UP', () => movePlayer(0, -1));
            scene.input.keyboard.on('keydown-DOWN', () => movePlayer(0, 1));
            scene.input.keyboard.on('keydown-LEFT', () => movePlayer(-1, 0));
            scene.input.keyboard.on('keydown-RIGHT', () => movePlayer(1, 0));
        }

        // Function to move player with grid constraints and collision detection
        function movePlayer(deltaX, deltaY) {
            // Calculate new position
            const newX = player1.x + deltaX;
            const newY = player1.y + deltaY;
            
            // Check if new position is within grid bounds
            if (newX < 0 || newX >= GRID_WIDTH || newY < 0 || newY >= GRID_HEIGHT) {
                return; // Out of bounds, don't move
            }
            
            // Check if new position is a wall (1) or floor (0)
            if (dungeonLayout[newY][newX] === 1) {
                return; // Hit a wall, don't move
            }
            
            // Valid move - update player position
            player1.x = newX;
            player1.y = newY;
            
            // Update sprite position
            updatePlayerSpritePosition();
        }

        // Function to update player sprite position based on grid coordinates
        function updatePlayerSpritePosition() {
            // Calculate starting position to center the grid (same as renderDungeonGrid)
            const startX = (800 - (GRID_WIDTH * TILE_SIZE)) / 2;
            const startY = (600 - (GRID_HEIGHT * TILE_SIZE)) / 2;
            
            // Calculate pixel position for player based on grid position
            const pixelX = startX + (player1.x * TILE_SIZE) + (TILE_SIZE / 2);
            const pixelY = startY + (player1.y * TILE_SIZE) + (TILE_SIZE / 2);
            
            // Update sprite position
            player1.sprite.setPosition(pixelX, pixelY);
        }

        function update() {
            // Game loop (empty for now)
        }

        // Initialize the game
        const game = new Phaser.Game(config);
    </script>
</body>
</html> 